<div class="max-w-4xl mx-auto card card-fixed animate-fade-in">
  <!-- Topp: Tittel og kontrollrekke -->
  <div class="flex flex-col justify-between gap-4 mb-6 sm:flex-row sm:items-center">
    <h2 class="text-2xl font-bold text-green-300">üìù {{ 'TODO.TITLE' | translate }}</h2>

    <div class="control-row">
      <label class="text-white">{{ 'TODO.SORT_BY' | translate }}</label>
      <select [(ngModel)]="sortBy" class="input field-h select-nowrap minw-ctrl">
        <option value="date">{{ 'TODO.SORT_DATE' | translate }}</option>
        <option value="name">{{ 'TODO.SORT_NAME' | translate }}</option>
        <option value="category">{{ 'TODO.SORT_CATEGORY' | translate }}</option>
      </select>

      <button (click)="toggleForm()" class="btn-link">
        {{ showForm ? ('TODO.HIDE_FORM' | translate) : ('TODO.SHOW_FORM' | translate) }}
      </button>

      <button
        *ngIf="anyDone"
        (click)="clearCompleted()"
        class="btn btn-danger btn-fixed select-nowrap"
      >
        {{ 'TODO.CLEAR_COMPLETED' | translate }}
      </button>
    </div>
  </div>

  <!-- Skjema -->
  <form *ngIf="showForm" (ngSubmit)="addTask()" class="mb-6 space-y-4">
    <div>
      <label class="form-label">{{ 'TODO.LABEL_TASK' | translate }}</label>
      <input
        [(ngModel)]="newTask"
        name="task"
        class="input field-h"
        [placeholder]="'TODO.PLACEHOLDER_TASK' | translate"
      />
    </div>

    <div class="form-grid">
      <div class="col-span-12 sm:col-span-6 lg:col-span-3">
        <label class="form-label">{{ 'TODO.LABEL_DUEDATE' | translate }}</label>
        <input [(ngModel)]="newDueDate" name="dueDate" type="date" class="input field-h" />
      </div>

      <div class="col-span-12 sm:col-span-6 lg:col-span-3">
        <label class="form-label">{{ 'TODO.LABEL_DUETIME' | translate }}</label>
        <input [(ngModel)]="newDueTime" name="dueTime" type="time" class="input field-h" />
      </div>

      <div class="col-span-12 sm:col-span-6 lg:col-span-3">
        <label class="form-label">{{ 'TODO.LABEL_CATEGORY' | translate }}</label>
        <select [(ngModel)]="newCategory" name="category" class="input field-h select-nowrap">
          <option value="" disabled>{{ 'TODO.OPT_CATEGORY' | translate }}</option>
          <option *ngFor="let c of categories" [value]="c">
            {{ 'TODO.CAT_' + c | translate }}
          </option>
          <option value="custom">{{ 'TODO.OPT_CATEGORY_CUSTOM' | translate }}</option>
        </select>
      </div>

      <div class="col-span-12 sm:col-span-6 lg:col-span-3">
        <label class="form-label">{{ 'TODO.LABEL_PRIORITY' | translate }}</label>
        <select [(ngModel)]="newPriority" name="priority" class="input field-h select-nowrap">
          <option value="" disabled>{{ 'TODO.OPT_PRIORITY' | translate }}</option>
          <option *ngFor="let p of priorities" [value]="p">
            {{ 'TODO.PRIO_' + p | translate }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-grid">
      <div class="col-span-12 lg:col-span-6">
        <label class="form-label">{{ 'TODO.LABEL_LINK' | translate }}</label>
        <input
          [(ngModel)]="newLink"
          name="link"
          class="input field-h select-nowrap"
          [placeholder]="'TODO.PLACEHOLDER_LINK' | translate"
        />
      </div>
      <div class="col-span-12 lg:col-span-6">
        <label class="form-label">{{ 'TODO.LABEL_NOTE' | translate }}</label>
        <textarea
          [(ngModel)]="newNote"
          name="note"
          class="input textarea-fixed"
          [placeholder]="'TODO.PLACEHOLDER_NOTE' | translate"
        ></textarea>
      </div>
    </div>

    <button type="submit" class="w-full btn btn-primary btn-fixed">
      {{ 'TODO.ADD_BUTTON' | translate }}
    </button>
  </form>

  <!-- Lister -->
  <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
    <!-- Aktive -->
    <div>
      <h3 class="mb-2 text-lg font-semibold text-green-300">
        {{ 'TODO.ACTIVE_TITLE' | translate }}
      </h3>
      <ul class="space-y-3">
        <li
          *ngFor="
            let t of activeTasks | slice : 0 : (showAllActive ? activeTasks.length : 3);
            trackBy: trackById
          "
          class="task"
          [ngClass]="priorityClass(t)"
        >
          <div class="task-grid">
            <!-- Header: tittel + kategori-tag -->
            <div class="min-w-0 task-head">
              <div class="flex items-center gap-2">
                <span class="font-medium truncate">{{ t.text }}</span>
                <span *ngIf="t.category" class="tag select-nowrap">{{ catLabel(t) }}</span>
              </div>
            </div>

            <!-- Actions (mobil: under, sm+: h√∏yre) -->
            <div class="flex justify-end gap-2 task-actions sm:justify-start">
              <button (click)="toggle(t)" class="btn btn-fixed btn-compact select-nowrap">
                {{ 'TODO.MARK_DONE' | translate }}
              </button>
              <button
                (click)="remove(t)"
                class="btn btn-danger btn-fixed btn-compact select-nowrap"
              >
                {{ 'TODO.REMOVE' | translate }}
              </button>
            </div>

            <!-- Meta: mobil = 2 kolonner, sm+ = chips p√• rad -->
            <div class="task-meta meta-grid text-white/80">
              <span *ngIf="t.startDate" class="tag">
                {{ 'TODO.META_START' | translate }}: {{ t.startDate }}
              </span>
              <span *ngIf="t.dueDate" class="tag">
                {{ 'TODO.SORT_DATE' | translate }}: {{ t.dueDate }}
              </span>
              <span *ngIf="t.dueTime" class="tag">
                {{ 'TODO.LABEL_DUETIME' | translate }}: {{ t.dueTime }}
              </span>
              <a
                *ngIf="t.link"
                class="chip-link tag"
                [href]="t.link"
                target="_blank"
                rel="noopener"
              >
                üîó {{ 'TODO.LINK' | translate }}
              </a>
              <span *ngIf="t.project" class="tag">
                {{ 'TODO.LABEL_PROJECT' | translate }}: {{ t.project }}
              </span>
            </div>

            <!-- Notat -->
            <div *ngIf="t.note" class="task-note note-box">
              {{ t.note }}
            </div>
          </div>
        </li>
      </ul>

      <button
        *ngIf="activeTasks.length > 3"
        (click)="toggleShowAll('active')"
        class="mt-2 text-xs text-green-300 hover:underline select-nowrap"
      >
        {{ showAllActive ? ('TODO.SHOW_LESS' | translate) : ('TODO.SHOW_MORE' | translate) }}
      </button>
    </div>

    <!-- Ferdige -->
    <div>
      <h3 class="mb-2 text-lg font-semibold text-green-300">
        {{ 'TODO.COMPLETED_TITLE' | translate }}
      </h3>
      <ul class="space-y-3">
        <li
          *ngFor="
            let t of completedTasks | slice : 0 : (showAllCompleted ? completedTasks.length : 3);
            trackBy: trackById
          "
          class="task opacity-80"
          [ngClass]="priorityClass(t)"
        >
          <div class="task-grid">
            <!-- Header: tittel + kategori-tag -->
            <div class="min-w-0 task-head">
              <div class="flex items-center gap-2">
                <span class="font-medium line-through truncate">{{ t.text }}</span>
                <span *ngIf="t.category" class="tag select-nowrap">{{ catLabel(t) }}</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex justify-end gap-2 task-actions sm:justify-start">
              <button (click)="toggle(t)" class="btn btn-fixed btn-compact select-nowrap">
                {{ 'TODO.MARK_ACTIVE' | translate }}
              </button>
            </div>

            <!-- Meta -->
            <div class="task-meta meta-grid text-white/70">
              <span *ngIf="t.startDate" class="tag">
                {{ 'TODO.META_START' | translate }}: {{ t.startDate }}
              </span>
              <span *ngIf="t.dueDate" class="tag">
                {{ 'TODO.SORT_DATE' | translate }}: {{ t.dueDate }}
              </span>
              <span *ngIf="t.dueTime" class="tag">
                {{ 'TODO.LABEL_DUETIME' | translate }}: {{ t.dueTime }}
              </span>
              <a
                *ngIf="t.link"
                class="chip-link tag"
                [href]="t.link"
                target="_blank"
                rel="noopener"
              >
                üîó {{ 'TODO.LINK' | translate }}
              </a>
              <span *ngIf="t.project" class="tag">
                {{ 'TODO.LABEL_PROJECT' | translate }}: {{ t.project }}
              </span>
            </div>

            <!-- Notat -->
            <div *ngIf="t.note" class="task-note note-box text-white/80">
              {{ t.note }}
            </div>
          </div>
        </li>
      </ul>

      <button
        *ngIf="completedTasks.length > 3"
        (click)="toggleShowAll('completed')"
        class="mt-2 text-xs text-green-300 hover:underline select-nowrap"
      >
        {{ showAllCompleted ? ('TODO.SHOW_LESS' | translate) : ('TODO.SHOW_MORE' | translate) }}
      </button>
    </div>
  </div>
</div>

<!--
  SAMMENDRAG (hva denne templaten gj√∏r)
  ----------------------------------------------------
  - Fjerner scroll fra kortet og lar hele siden scrolle naturlig.
  - Rydder opp skjema:
      ‚Ä¢ Labels over feltene, konsekvent grid (1 / 2 / 4 kolonner).
      ‚Ä¢ Egendefinert kategori vises kun n√•r den trengs.
      ‚Ä¢ Notat som <textarea> for bedre skriving.
      ‚Ä¢ √ân, stor ¬´Legg til¬ª-knapp nederst.
  - Bruker .tag-chips i oppgavekort for meta (dato/tid/kategori osv.).
  - Beholder farger og stil (.card/.input/.btn) fra styles.css.
-->
