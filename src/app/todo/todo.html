<!-- Fil: src/app/todo/todo.html -->

<!--
  Rot-container for todo-delen. 
  - class="card animate-fade-in": dine egne/utility-klasser (Tailwind/egen CSS) som gir kort-stil og fade-in.
-->
<div class="card animate-fade-in">
  <h2 class="text-2xl font-bold text-green-300 mb-4">📝 Min Todo-liste</h2>

  <!--
    INNSENDINGSSKJEMA
    ----------------------------------------------------
    - (submit)="addTask()": binder DOM submit-event til komponentmetoden addTask().
      Merk: Angular har også (ngSubmit) på <form> når man bruker ngForm; (ngSubmit) hindrer default submit automatisk.
      Her bruker du (submit), som funker – men da må addTask() enten returnere false eller selv hindre default hvis du vil unngå full side-refresh.
      Siden du er i SPA og det ikke er action-attr, pleier dette å være ok, men (ngSubmit) er "Angular-måten".
    - grid-klasser: Tailwind for responsiv layout.
  -->
  <form (submit)="addTask()" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
    <!--
      OPPGAVETEKST (to-veis binding)
      ----------------------------------------------------
      - [(ngModel)]="newTask": toveis-binding mellom input og komponentfeltet newTask.
      - name="task": PÅKREVD for ngModel når feltet er inne i et <form> (template-driven forms).
      - required: enkel HTML-validering (deaktiverer submit i noen nettlesere og gir tilbakemelding).
    -->
    <input
      [(ngModel)]="newTask"
      name="task"
      required
      placeholder="Hva skal gjøres?"
      class="input w-full col-span-1 sm:col-span-2"
    />

    <!--
      FORFALLSDATO
      ----------------------------------------------------
      - Binder valgt dato til newDueDate (string i yyyy-mm-dd).
    -->
    <input [(ngModel)]="newDueDate" name="dueDate" type="date" class="input w-full" />

    <!--
      FORFALLSTID
      ----------------------------------------------------
      - Binder valgt tid til newDueTime (string i HH:mm).
    -->
    <input [(ngModel)]="newDueTime" name="dueTime" type="time" class="input w-full" />

    <!--
      KATEGORI (select)
      ----------------------------------------------------
      - [(ngModel)]="newCategory": valgt verdi (string) bindes til komponenten.
      - *ngFor="let c of categories": lister opp kategorier fra komponentfeltet `categories: string[]`.
      - <option value="" disabled selected> fungerer som placeholder ved første render.
        Når ngModel setter en reell verdi, vil den overstyre 'selected'.
    -->
    <select [(ngModel)]="newCategory" name="category" class="input w-full bg-slate-800 text-white">
      <option value="" disabled selected class="text-white bg-slate-800">Velg kategori</option>
      <option *ngFor="let c of categories" [value]="c" class="text-white bg-slate-800">
        {{ c }}
      </option>
      <option value="custom" class="text-white bg-slate-800">Egendefinert...</option>
    </select>

    <!--
      EGENDEFINERT KATEGORI (vises betinget)
      ----------------------------------------------------
      - *ngIf="newCategory === 'custom'": strukturdirektiv (Angular lager behind-the-scenes et <ng-template>).
      - Toveis-binding til customCategory. 
      - Ekstra visuelle klasser for mørkt input-felt.
    -->
    <input
      *ngIf="newCategory === 'custom'"
      [(ngModel)]="customCategory"
      name="customCategory"
      placeholder="Egen kategori"
      class="input w-full bg-gray-800 text-white border border-gray-600 placeholder-gray-400 focus:ring-2 focus:ring-green-400 appearance-none"
    />

    <!--
      LEGG TIL-KNAPP
      ----------------------------------------------------
      - type="submit": trigger formens (submit) handler (addTask()).
      - Tailwind-klasser via dine util-klasser btn/btn-primary.
    -->
    <button
      type="submit"
      class="btn btn-primary w-full col-span-1 sm:col-span-2 lg:col-span-5 mt-2"
    >
      ➕ Legg til
    </button>
  </form>

  <!--
    LISTESEKSJON
    ----------------------------------------------------
    - grid for å vise aktive og ferdige side ved side på md+ skjermstørrelser.
  -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
    <!--
      AKTIVE OPPGAVER
      ----------------------------------------------------
      - *ngFor="let task of activeTasks; trackBy: trackById"
        -> 'activeTasks' er avledet liste (filter av tasks) levert fra komponenten.
        -> 'trackById' optimaliserer rendering (Angular bruker id for diffing).
      - Hver item har:
        - checkbox bundet via (change)="toggle(task)" for å flippe done.
        - fjern-knapp (remove(task)).
        - meta-linje under (dato/tid/kategori) som vises bare når feltet finnes (*ngIf).
    -->
    <div>
      <h3 class="text-lg font-semibold text-green-300 uppercase mb-2">Aktive</h3>
      <ul class="space-y-2">
        <li
          *ngFor="let task of activeTasks; trackBy: trackById"
          class="flex flex-col bg-slate-700 p-3 rounded-lg"
        >
          <div class="flex items-center justify-between">
            <label class="flex items-center gap-3">
              <!-- [checked] binder one-way til task.done. (change) kaller toggle(task) -->
              <input
                type="checkbox"
                [checked]="task.done"
                (change)="toggle(task)"
                class="accent-green-300"
              />
              <span class="text-white">{{ task.text }}</span>
            </label>
            <button (click)="remove(task)" class="btn btn-danger">❌</button>
          </div>

          <!--
            Meta-info: vises kun når felt eksisterer.
            *ngIf på span-elementene: Angular inkluderer/ekskluderer elementet dynamisk.
          -->
          <div class="flex items-center text-xs text-white/70 space-x-4 mt-1 ml-7">
            <span *ngIf="task.dueDate">📅 {{ task.dueDate }}</span>
            <span *ngIf="task.dueTime">⏰ {{ task.dueTime }}</span>
            <span *ngIf="task.category" class="tag">🗂️ {{ task.category }}</span>
          </div>
        </li>
      </ul>
    </div>

    <!--
      FERDIGE OPPGAVER
      ----------------------------------------------------
      - Samme struktur som aktive, men datakilde er completedTasks (filter på done===true).
      - Ekstra stil: line-through på tekst og redusert opacity for "ferdig"-look.
    -->
    <div>
      <h3 class="text-lg font-semibold text-green-300 uppercase mb-2">Ferdige</h3>
      <ul class="space-y-2">
        <li
          *ngFor="let task of completedTasks; trackBy: trackById"
          class="flex flex-col bg-slate-600 p-3 rounded-lg opacity-70"
        >
          <div class="flex items-center justify-between">
            <label class="flex items-center gap-3">
              <input
                type="checkbox"
                [checked]="task.done"
                (change)="toggle(task)"
                class="accent-green-300"
              />
              <span class="text-white line-through">{{ task.text }}</span>
            </label>
            <button (click)="remove(task)" class="btn btn-danger">❌</button>
          </div>

          <div class="flex items-center text-xs text-white/70 space-x-4 mt-1 ml-7">
            <span *ngIf="task.dueDate">📅 {{ task.dueDate }}</span>
            <span *ngIf="task.dueTime">⏰ {{ task.dueTime }}</span>
            <span *ngIf="task.category" class="tag">🗂️ {{ task.category }}</span>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>

<!--
  SAMMENDRAG (hva denne templaten gjør)
  ----------------------------------------------------
  - Viser et skjema for å registrere ny oppgave:
      • newTask (tekst), newDueDate (dato), newDueTime (tid), newCategory (valg), customCategory (tekst ved 'custom').
      • Bruker [(ngModel)] for toveis-binding. name-attributt er påkrevd for ngModel i form.
      • (submit)="addTask()" kaller komponentmetoden som oppretter ny Task.
        Tips: vurder (ngSubmit) på <form> for mer "Angular-riktig" håndtering.
  - Viser to lister:
      • Aktive (activeTasks) og Ferdige (completedTasks), hver rendret med *ngFor og trackById for ytelse.
      • toggle(task) flipper done; remove(task) sletter.
      • Meta-informasjon (dueDate, dueTime, category) vises kun når den finnes med *ngIf.
  - Tailwind/utility-klasser brukes for layout/typografi/farger; egne helper-klasser (card, btn, tag) kan være definert i din CSS.
-->
